#!/bin/bash

# Git AI Commit Message Generator
# Usage: ./gitai or gitai (if in PATH)
# Example: gitai && git ai

# Resolve the actual script location, following symlinks
if [[ -L "${BASH_SOURCE[0]}" ]]; then
    # If this script is a symlink, resolve it
    SCRIPT_PATH=$(readlink "${BASH_SOURCE[0]}")
    # If the resolved path is relative, make it absolute
    if [[ ! "$SCRIPT_PATH" = /* ]]; then
        SCRIPT_PATH="$(dirname "${BASH_SOURCE[0]}")/$SCRIPT_PATH"
    fi
else
    SCRIPT_PATH="${BASH_SOURCE[0]}"
fi

SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"

# Run the Git AI agent and capture the output
COMMIT_MSG=$(cd "$SCRIPT_DIR" && uv run python git_agent.py)

# Store in environment variable and a temp file for persistence across shells
echo "$COMMIT_MSG" > /tmp/gitai_last_commit

# Also output to stdout for backward compatibility
echo "$COMMIT_MSG"